if ( ENABLE_SHARED )
    set(libbroker broker)
else ()
    set(libbroker brokerStatic)
endif ()

macro(unit_test name)
    add_executable(${name} ${name}.cc)
    target_link_libraries(${name} ${libbroker})

    if ( ${ARGC} EQUAL 1 )
        add_test(NAME ${name} COMMAND ${name})
    else ()
        foreach ( _arg ${ARGN} )
            add_test(NAME ${name}_${_arg} COMMAND ${name} ${_arg})
        endforeach ()
    endif ()

endmacro()

set(backends memory;sqlite)

if ( ROCKSDB_FOUND )
    add_definitions(-DHAVE_ROCKSDB)
    set(backends ${backends} rocksdb)
endif ()

unit_test(test_print)
unit_test(test_print_remote)
unit_test(test_event local;remote)
unit_test(test_log   local;remote)
unit_test(test_store_master)
unit_test(test_store_clone)
unit_test(test_store_frontend)
unit_test(test_store_remote)
unit_test(test_store_backend ${backends})
unit_test(test_store_expiry ${backends})
unit_test(test_subscription_matching)
unit_test(test_variant)
unit_test(test_optional)
unit_test(test_data)
unit_test(test_network_types)
unit_test(test_radix_tree)
